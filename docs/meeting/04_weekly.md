# 오픈소스 SW 기초
# 팀 프로젝트 Weekly Report - 4주차

- **프로젝트명**: NoR (Not only R)
- **팀명**: NoR 팀 (Team 7)
- **주차**: 제4주차
- **기간**: 2025.05.22 ~ 2025.05.28
- **작성자**: 최현경
- **팀원**: 최현경(32224802), 류지성(32241484), 이운길(32237627)

## 목차
1. 서론
2. Lang: DSL 언어 설계 및 실행기 구조
   2.1 DSL 문법 확장
   2.2 실행 가능한 속성값 정의
   2.3 의미 분석기 설계 및 구현
   2.4 파서 및 파스트리 구조 개선
   2.5 실행기 내부 구조 및 트리 순회 전략
3. Graph: 시각화 처리 및 옵션 구조
   3.1 그래프 유형별 실행 구조
   3.2 옵션 딕셔너리 통일 및 속성 정의
   3.3 선/막대/산점도 그래프별 설정 차이
   3.4 시각화 출력 및 저장 처리 분리
   3.5 색상, 마커, 선 스타일 처리 구조
   3.6 에러 처리 및 자동 기본값 처리
4. GUI: 사용자 인터페이스 구현 및 피드백
   4.1 PySimpleGUI 기반 초기 프로토타입 구성
   4.2 기능별 개선 사항 및 문제 정리
   4.3 테마 전환 및 상태 유지 처리
   4.4 실행 흐름 / 샘플 로딩 / 저장 기능
   4.5 프론트엔드 기술 전환 논의 (React 전환)
   4.6 향후 인터랙션 설계 및 디자인 개선 방향
5. 결론 및 향후 계획

## 1. 서론

NoR(Not Only R)은 사용자 친화적인 한글 기반 DSL(Domain-Specific Language)을 통해 누구나 텍스트 명령어만으로 고품질 그래프를 생성할 수 있도록 지원하는 프로젝트이다. 본 프로젝트는 복잡한 프로그래밍 없이도 다양한 시각화 작업을 직관적으로 수행할 수 있도록 설계되었으며, 특히 논문 및 리포트 작성 등 전문적인 용도의 그래프 생성을 주요 목표로 한다.

4주차(2025년 5월 22일 ~ 28일) 개발은 DSL 문법 구조의 확장, 의미 분석기 도입, 파서 및 실행기 내부 설계 정비, GUI 기능 개선에 중점을 두고 진행되었다. 또한 기존 PySimpleGUI 기반 프로토타입에서 React 기반 웹 인터페이스로의 전환을 본격적으로 검토하였으며, 그래프 종류별 속성값과 시각화 옵션을 체계적으로 정리하여 실행기의 유효성 검증 및 사용자 입력 처리의 정확성을 향상시키고자 하였다.

본 보고서에서는 4주차 동안 진행된 주요 개발 내역과 구조 설계 변경 사항, 기술 스택 전환 논의 및 향후 개선 방향을 종합적으로 정리하였다. 이를 통해 NoR DSL 실행기의 전체적인 기술적 안정성과 사용자 경험 품질을 동시에 제고하고자 한다.

## 2. Lang: DSL 언어 설계 및 실행기 구조

### 2.1 DSL 문법 확장

4주차에서는 DSL 문법 구조를 보다 유연하고 확장성 있게 다듬기 위해 명령문(statement)의 유형을 세분화하고, 구체적인 문법 키워드를 정의하였다. 기존의 단순 명령문 외에도 속성 할당문, 복합 속성 설정, 데이터 정의, 입출력 명령 등이 분리되었으며, 이를 기반으로 문법 트리의 구성도 재정비하였다.

또한 EBNF 기반 문법 정의에 따라 다음과 같은 규칙 체계를 정립하였다. 모든 문법은 Lark 기반의 .lark 문서에 정의되며, 향후 GUI 기반 도움말 및 자동완성 기능과 연동될 예정이다.

| 분류 | 규칙 이름 | 설명 |
|------|-----------|------|
| 시작 규칙 | start | 최상위 엔트리포인트 |
| 명령문 | property_assignment_statement | 단일 속성 할당 (예: 색은 "파랑") |
| 명령문 | complex_assignment_statement | 복합 속성 설정 (예: 축이름 "x" "y") |
| 명령문 | data_statement | 벡터 데이터 정의 (예: 데이터는 [...]) |
| 명령문 | draw_statement | 실행 명령 (예: 그리기) |
| 명령문 | create_graph_statement | 그래프 컨텍스트 시작 |
| 명령문 | io_statement | 저장, 불러오기 등 입출력 명령 |

### 2.2 실행 가능한 속성값 정의

그래프 DSL은 유효한 속성값의 목록이 존재하며, 잘못된 값에 대해서는 의미 분석 단계에서 오류를 반환해야 한다. 이에 따라 다음과 같은 값 집합이 정의되었다.

- **그래프 종류**: {"선그래프", "막대그래프", "산점도그래프"}
- **색상**: "빨강", "파랑", "green", "#FF0000" 등 한글/영문/HEX 지원
- **마커 문양**: "o", "x", ".", "삼각형", "별" 등 다양한 형태 지원
- **선 스타일**: "실선", "점선", "-", "--", "-." 등
- **범례 위치**: "upper right", "center", "lower left" 등

이 값들은 nor_config.py 파일에서 카테고리별로 집계되며, 속성별로 대응되는 유효값 세트를 통해 검증을 수행한다.

### 2.3 의미 분석기 설계 및 구현

문법 오류를 넘어서 속성의 유효성 검사, 데이터 타입 일관성 검사 등을 수행하기 위해 SemanticAnalyzer 클래스를 구현하였다. Lark의 Visitor 패턴을 기반으로 의미 분석기를 구성하였으며, 주요 기능은 다음과 같다.

1. **속성값 유효성 검증**
   - "종류는 막대그래프"와 같은 문장에서 "막대그래프"가 실제 유효한 값인지 검사한다.
   - VALID_PROPERTY_VALUES 딕셔너리를 기반으로 유효성을 판단한다.

2. **벡터 타입 일관성 검사**
   - [1, 2, "3"]과 같은 혼합형 벡터를 오류로 감지하고, 에러 메시지에 해당 라인 정보를 포함하여 사용자에게 반환한다.

3. **오류 수집 전략**
   - fail-fast 방식과 전체 수집 방식 중 후자를 택하여, 가능한 모든 오류를 한 번에 사용자에게 안내하는 구조로 설계하였다.

### 2.4 파서 및 파스트리 구조 개선

Lark는 입력된 DSL 스크립트를 Tree 객체 구조로 파싱하며, 내부적으로는 Tree.data와 Tree.children 속성을 사용하여 구문 계층을 구성한다. 이번 주차에서는 다음과 같은 방향으로 구조 개선을 진행하였다.

- **Tree와 Token 객체의 명확한 구분**
  - Tree: 비터미널(규칙), Token: 터미널(문자열, 숫자 등)

- **순회 방식 개선**
  - 의미 분석에는 Visitor, 실행기에는 Transformer를 사용하여 목적별 구분을 명확히 하였다.

- **구문 분리 및 우선순위 처리 강화**
  - 벡터 표현식에서 빈 벡터와 값이 있는 벡터를 명확히 분리하고, 줄바꿈 처리 등에서 발생하는 파싱 오류를 해결하였다.

### 2.5 실행기 내부 구조 및 트리 순회 전략

DSL 명령어가 Transformer를 통해 AST에서 딕셔너리 구조로 변환된 후, 실제 실행은 GraphExecutor 클래스를 통해 수행된다. 내부 구조는 다음과 같은 방식으로 구성되어 있다.

- execute(command_list) 함수에서 명령 순차 처리
- 각 명령은 "명령" 키를 기준으로 분기 실행
- draw_line(), draw_bar() 등 그래프 종류에 따라 전용 함수 호출
- option 딕셔너리에 포함된 시각화 속성을 내부 처리 함수에서 적용

이 구조는 새로운 그래프 유형을 추가하거나 옵션을 확장할 때도 기존 로직을 침해하지 않고 모듈화된 방식으로 기능을 확장할 수 있도록 구성되어 있다.

## 3. Graph: 시각화 처리 및 옵션 구조

### 3.1 그래프 유형별 실행 구조

NoR DSL의 시각화 처리는 matplotlib 라이브러리를 기반으로 수행되며, DSL에서 추출한 속성과 데이터를 기준으로 그래프를 구성하는 구조로 되어 있다. 사용자가 작성한 DSL 스크립트는 다음과 같은 단계를 거쳐 시각화된다.

1. 문법 파싱 및 AST 변환
2. 의미 분석 및 속성값 검증
3. 실행기(GraphExecutor)에서 명령어 실행
4. 내부 상태를 바탕으로 matplotlib 호출
5. 생성된 이미지를 파일로 저장 및 전달

이 구조는 명령어 기반의 인터프리터 구조와 시각화 백엔드가 느슨하게 결합되어 있어 확장성과 유지보수성이 높다는 장점이 있다.

### 3.2 옵션 딕셔너리 통일 및 속성 정의

그래프 종류는 DSL에서 "종류는 막대그래프", "종류는 선그래프" 등의 명령으로 설정할 수 있으며, 내부적으로는 다음과 같은 방식으로 처리된다.

- 종류 설정 명령은 "종류" 키로 저장됨
- 실행기에서 해당 키를 읽어 self.graph_type에 저장
- 최종 실행 시, 종류에 따라 matplotlib의 함수가 분기 호출됨

```python
if self.graph_type == "선그래프":
    plt.plot(x, y, ...)
elif self.graph_type == "막대그래프":
    plt.bar(x, y, ...)
elif self.graph_type == "산점도그래프":
    plt.scatter(x, y, ...)
```

### 3.3 선/막대/산점도 그래프별 설정 차이

사용자가 입력한 다양한 속성(색상, 마커, 선 스타일 등)은 내부적으로 self.options 딕셔너리에 저장되며, 그래프 실행 시 각 matplotlib 함수에 인자로 전달된다. 주요 속성은 다음과 같다.

| DSL 속성 키 | 내부 처리 키 | 예시 값 | matplotlib 인자 |
|------------|-------------|---------|----------------|
| 색 | color | "파랑" | color="#1F77B4" |
| 선 굵기 | linewidth | 3 | linewidth=3 |
| 마커 | marker | "o" | marker="o" |
| 마커 크기 | markersize | 6 | markersize=6 |
| 선 스타일 | linestyle | "--" | linestyle="--" |

### 3.4 시각화 출력 및 저장 처리 분리

DSL에서는 "빨강", "파랑" 등의 한글 색상명을 지원하며, 이를 HEX 코드로 변환하기 위해 convert_color() 함수를 구현하였다. 내부적으로는 사전 매핑을 통해 변환을 수행하며, 변환 예시는 다음과 같다.

```python
convert_color("파랑") → "#1F77B4"
convert_color("초록") → "#2CA02C"
```

### 3.5 색상, 마커, 선 스타일 처리 구조

NoR DSL은 "스타일은 논문용"과 같은 단일 명령으로 일괄적인 스타일을 적용할 수 있도록 프리셋 기능을 지원한다. 이는 style_config.py에 정의된 딕셔너리를 불러오는 방식으로 작동하며, 예시 구조는 다음과 같다.

```python
"논문용": {
    "font.family": "serif",
    "axes.titlesize": 14,
    "lines.linewidth": 2,
    "legend.loc": "upper right"
}
```

### 3.6 에러 처리 및 자동 기본값 처리

DSL에서 "x는 [1, 2, 3]", "y는 [4, 5, 6]"과 같은 명령을 통해 직접 데이터를 정의할 수 있으며, 내부적으로는 다음과 같은 처리 과정을 거친다.

1. Lark를 통한 벡터 구문 파싱
2. AST 변환 시 리스트 객체로 반환
3. 의미 분석기에서 벡터 요소의 타입 일관성 검사
4. 실행기에서 self.data["x"], self.data["y"]에 저장
5. 시각화 시 해당 값을 matplotlib에 전달

벡터 구문에서 줄바꿈이나 빈 벡터와 같은 예외가 발생하는 경우를 대비해, vector: empty_vector | non_empty_vector로 구문을 분리하여 안정적인 파싱을 지원한다.

## 4. GUI: 사용자 인터페이스 구현 및 피드백

### 4.1 PySimpleGUI 기반 초기 프로토타입 구성

NoR 프로젝트의 GUI는 사용자가 DSL을 직접 작성하고 결과 그래프를 바로 확인할 수 있는 실행기 형태로 기획되었다. 복잡한 설정 없이도 직관적으로 실행 흐름을 경험할 수 있도록, 코드 작성 → 실행 → 시각화 확인이라는 일련의 과정을 시각적 인터페이스로 구현하는 것을 목표로 하였다.

구체적인 기획 참고 사례로는 DartPad, Observable, JupyterLab 등의 인터랙티브 환경이 있으며, NoR은 이를 단순화된 형태로 재구성하였다.

### 4.2 기능별 개선 사항 및 문제 정리

NoR 실행기는 좌측 코드 입력창과 우측 시각화 영역으로 나뉘며, 하단에는 로그 패널을 포함한 3단 구조를 갖는다. 전체 레이아웃 구성은 다음과 같다.

1. **좌측 상단**
   - NoR 로고: 클릭 시 첫 화면(Home)으로 이동

2. **좌측 패널**
   - 명령어 입력창 (Monaco Editor): DSL 입력 전용 에디터
   - 문법 하이라이팅 및 자동 들여쓰기 기능 포함

3. **우측 메인 영역**
   - 그래프 출력창 (Canvas): Backend에서 렌더링된 matplotlib 이미지를 출력
   - 다크모드/라이트모드에 따라 배경이 자동 전환됨

4. **하단 로그 패널**
   - 실행 로그 및 파싱 오류, 시스템 메시지 등을 출력
   - 실행 성공/실패 여부 및 경고 표시

5. **툴바 버튼**
   - Run: DSL 실행
   - Reset: 입력 내용 초기화
   - New: 새로운 실행기 창 생성
   - Samples: 예제 DSL 로드
   - Theme: 라이트/다크 모드 전환

### 4.3 테마 전환 및 상태 유지 처리

각 버튼은 키보드 단축키 또는 클릭을 통해 접근 가능하도록 하여, 사용자 경험을 개선하였다.

| 버튼 이름 | 기능 설명 |
|-----------|-----------|
| Run | 현재 DSL 명령 실행 (Cmd/Ctrl + Enter 단축키) |
| Reset | 입력창 초기화 |
| New | 새로운 DSL 작업 환경 생성 |
| Samples | 샘플 명령어 자동 입력 |
| Theme | 라이트/다크 모드 전환 |
| 파일명 표시 | 현재 작업 중인 파일명 또는 저장 상태 표시 |

### 4.4 실행 흐름 / 샘플 로딩 / 저장 기능

1. **다크모드/라이트모드 지원**
   - TailwindCSS의 클래스 전환 기반으로, 사용자 취향에 맞게 테마를 변경할 수 있도록 설계하였다.

2. **실행 시 애니메이션 효과**
   - Framer Motion을 이용해 실행 결과가 페이드 인되는 효과를 주어, 시각적 응답성을 높였다.

3. **에러 UX 처리**
   - 파싱 오류 발생 시: 로그 패널에 빨간색 강조 메시지 표시
   - 성공 메시지: "그래프가 성공적으로 생성되었습니다" 등으로 사용자 피드백 제공

4. **코드 자동완성과 문법 강조**
   - Monaco Editor를 활용해 향후 명령어 자동완성 및 문법 강조 색상 처리 기능을 확장할 계획이다.

### 4.5 프론트엔드 기술 전환 논의 (React 전환)

| 영역 | 사용 기술 |
|------|-----------|
| Frontend | React, TailwindCSS, Ant Design, Framer Motion |
| Editor | Monaco Editor (VS Code 기반) |
| Graph Backend | matplotlib (Python) |
| 상태관리 (예정) | Zustand 또는 Redux |
| 애니메이션 | Framer Motion |

오픈소스 기반으로 진행해 유지보수 및 커스터마이징이 용이하다는 장점을 갖는다.

### 4.6 향후 인터랙션 설계 및 디자인 개선 방향

실제 Figma로 제작한 와이어프레임을 기준으로 다음과 같은 화면이 구성되었다.

## 5. 결론 및 향후 계획

### 5.1 구현 중 발생한 이슈 및 해결 과정

1. **Lark 벡터 구문 오류**
   - 문제 상황: 벡터를 정의할 때 줄바꿈 문자인 _NL을 제대로 처리하지 않아 파싱 에러가 발생함.
   ```python
   vector: "[" [element ("," element)*] "]"
   ```
   - 에러 메시지:
   ```
   lark.exceptions.UnexpectedToken: Unexpected token Token('_NL', '\n\n')
   Expected one of: * _RBRA
   ```
   - 해결 방법: 빈 벡터와 비어 있지 않은 벡터를 명확히 구분하는 방식으로 문법을 분리함.
   ```python
   vector: empty_vector | non_empty_vector
   empty_vector: "[" "]"
   non_empty_vector: "[" elements "]"
   elements: element ("," element)*
   ```

2. **색상 한글 입력 처리**
   - 문제 상황: 사용자가 "빨강", "파랑" 등 한글로 색상을 입력할 경우 matplotlib이 인식할 수 없음.
   - 해결 방법: 한글 색상명 → HEX 코드 변환 처리를 위한 convert_color() 함수를 구현함.
   ```python
   convert_color("파랑") → "#1F77B4"
   ```
   - 변환 예시:
   | 입력값 | 변환 결과 |
   |--------|-----------|
   | "빨강" | "#D62728" |
   | "노랑" | "#FFDD57" |

3. **선굵기 + 마커 크기 매핑**
   - 문제 상황: 사용자가 "굵기는 3"과 같은 명령으로 선의 굵기와 마커 크기를 동시에 제어하길 원함.
   - 해결 방법: 매핑 테이블을 구성하여 선 굵기와 마커 크기를 자동으로 연동함.
   ```python
   thickness_map = {
       1: {"linewidth": 1, "markersize": 3},
       2: {"linewidth": 2, "markersize": 4.5},
       3: {"linewidth": 3, "markersize": 6},
   }
   ```

4. **스타일 프리셋 적용**
   - 문제 상황: 사용자가 "스타일은 논문용"과 같이 일괄 스타일을 지정하고자 함.
   - 해결 방법: style_config.py에 사전 정의된 프리셋을 구성하여 한 줄 명령으로 그래프 전체 스타일을 적용할 수 있도록 함.
   ```python
   preset = {
       "논문용": {
           "font": "Times New Roman",
           "linewidth": 2,
           "markersize": 4,
           "style": "classic"
       },
       "모던": {
           "font": "Noto Sans",
           "linewidth": 2,
           "markersize": 5,
           "style": "ggplot"
       },
   }
   ```
   - 향후 계획: 사용자 정의 프리셋 .norstyle 파일 형식으로 저장/불러오기 기능 확장 검토 중임.

### 5.2 향후 개선 및 보완 과제

| 항목 | 설명 |
|------|------|
| CSV 불러오기 | 외부 CSV 파일을 불러와서 x/y 데이터를 자동 지정하는 기능 도입 예정임 |
| 명령어 자동완성 | Monaco Editor와 연동한 자동완성 기능 확장 예정임 |
| 에러 메시지 개선 | 현재는 단순한 예외 메시지만 출력되므로, 보다 친절하고 구체적인 한국어 오류 메시지로 개선할 계획임 |
| 스타일 커스터마이징 | 다양한 마커 스타일 및 선 패턴 지원 예정임 |
| 반응형 UI | 태블릿 및 모바일 환경에서도 사용 가능한 인터페이스로 확장할 계획임 |

### 5.3 회의 요약 (2025년 5월 22일 회의 기준)

| 시간 | 참석자 | 논의 주요 내용 |
|------|--------|----------------|
| 오후 4시 | 최현경, 류지성, 이운길 | DSL 문법 확장 방향 논의, GUI 실행기 구조 정리, 명령어 추상화 단계 검토, 에디터 자동완성 도입 가능성 논의 |

회의 결정 사항:
1. "굵기", "스타일", "색상" 등의 명령어는 추상화 레벨을 높여 한 줄로 처리 가능하도록 함
2. 사용자 정의 명령어 및 실행 예시 구조 추가
3. DSL 문법 확장은 기존 스타일 유지(한글 기반) 원칙을 고수하되, 일부 키워드는 영어와 병기함 (e.g., "그리기"와 "draw" 병렬 지원)
4. GUI는 반응형 구조를 고려하되 초기 버전은 데스크탑 중심으로 구성함

이상으로 4주차(2025년 5월 22일 ~ 28일) 개발 및 문서화 작업을 마무리하며, 다음 회차부터는 최종 발표를 대비하여 DSL 명령어 고도화, CSV 파싱 및 GUI 기능 정교화 작업을 중심으로 개발을 이어갈 계획이다. 